<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Radio LPK-Sadulur Modern</title>
<link rel="icon" href="image/favicon.png" type="image/png">

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@400;600&display=swap');

body {
  margin: 0;
  font-family: 'Inter','Poppins',sans-serif;
  background: #0f172a;
  color: #f1f5f9;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  min-height: 100vh;
}

h1 {
  margin: 5px 0;
  font-size: 2rem;
  color: #38bdf8;
  text-align: center;
}

#logo {
  width: 80%;
  max-width: 400px;
  height: auto;
  margin-bottom: 10px;
  transition: all 0.3s;
}

.marquee {
  width: 90%;
  overflow: hidden;
  white-space: nowrap;
  background: #334155;
  border-radius: 8px;
  padding: 5px 0;
  margin-bottom: 20px;
}

.marquee-inner {
  display: inline-block;
  padding-left: 100%;
  animation: slide-left 12s linear infinite;
  font-weight: bold;
  background: linear-gradient(90deg,#38bdf8,#a855f7,#f43f5e,#f59e0b,#38bdf8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

@keyframes slide-left {
  0% { transform: translateX(0); }
  100% { transform: translateX(-100%); }
}

.live-info {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 3px;
  margin-bottom: 15px;
}

.status-live {
  font-size: 1.2rem;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 8px;
  color: #38bdf8;
}

.live-icon {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: red;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%,50%,100%{ opacity:1; }
  25%,75%{ opacity:0; }
}

.dj-name { font-weight: bold; font-size: 1.1rem; color: #38bdf8; }
.song-title { font-weight: bold; font-size: 0.95rem; color: #f43f5e; }

.player-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
}

.controls { display: flex; gap: 15px; }

.play-btn, .pause-btn {
  font-size: 1.2rem;
  padding: 12px 25px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background: linear-gradient(45deg,#38bdf8,#a855f7);
  color: #0f172a;
  font-weight: 600;
  transition: all 0.3s;
}

.play-btn:hover, .pause-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 0 15px rgba(56,189,248,0.7);
}

.volume-control {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
  flex-direction: row-reverse;
}

.volume-control input { width: 120px; cursor: pointer; }

.equalizer {
  display: flex;
  gap: 2px;
  align-items: flex-end;
  justify-content: center;
  height: 100px;
  margin: 10px 0 20px 0;
}

.bar {
  width: 5px;
  background: linear-gradient(180deg,#38bdf8,#a855f7,#f43f5e,#f59e0b);
  border-radius: 3px;
  transition: height 0.1s;
}

.top-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-bottom: 15px;
}

.top-buttons button {
  padding: 8px 18px;
  border: none;
  border-radius: 8px;
  background: #38bdf8;
  color: #0f172a;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
}

.top-buttons button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 12px rgba(56,189,248,0.7);
}

.slider {
  display: flex;
  overflow: hidden;
  width: 90%;
  max-width: 500px;
  border-radius: 8px;
  margin-bottom: 10px;
}

.slider-track {
  display: flex;
  animation: scroll 20s linear infinite;
}

.slider img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 8px;
  margin-right: 10px;
}

@keyframes scroll { 0%{transform:translateX(0);}100%{transform:translateX(-50%);} }

#clock { margin-bottom: 20px; font-size: 0.9rem; color: #94a3b8; }

footer {
  padding: 10px;
  font-size: 0.9rem;
  background: #1e293b;
  width: 100%;
  color: #94a3b8;
  margin-top: auto;
}

/* Request Modal */
#requestModal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
#requestModalContent { background: #0f172a; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; color: #f1f5f9; text-align:left; position: relative; }
#requestModalContent input, #requestModalContent textarea { width:100%; margin-bottom:10px; padding:8px; border-radius:6px; border:none; background:#1e293b; color:#f1f5f9; }
#requestModalContent button { padding: 8px 15px; border:none; border-radius:8px; cursor:pointer; }
#closeRequest { background:#f43f5e; color:#fff; }
#submitRequest { background:#38bdf8; color:#0f172a; }

/* Live Chat */
.chat-container {
  width: 90%;
  max-width: 400px;
  margin: 20px auto;
  display: flex;
  flex-direction: column;
  border: 1px solid #334155;
  border-radius: 10px;
  background: #1e293b;
}

.chat-container h2 { 
  margin: 10px 0; 
  color: #38bdf8; 
  text-align: center; 
}

.chat-box {
  height: 300px;
  overflow-y: auto;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  background: #0f172a;
  border-bottom: 1px solid #334155;
}

.chat-msg {
  padding: 8px 12px;
  border-radius: 15px;
  max-width: 75%;
  word-wrap: break-word;
  color: #f1f5f9;
  font-size: 0.9rem;
  line-height: 1.2rem;
}

.chat-msg.user { background: #38bdf8; align-self: flex-end; color:#0f172a; }
.chat-msg.other { background: #334155; align-self: flex-start; }

.chat-input {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 8px;
  background: #1e293b;
  border-radius: 0 0 10px 10px;
}

.message-send {
  display: flex;
  gap: 5px;
  flex-wrap: wrap;
}

.message-send input[type=text] {
  flex: 1;
  min-width: 0;
}

.message-send button {
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  background: #38bdf8;
  color: #0f172a;
  cursor: pointer;
  font-weight: 600;
  white-space: nowrap;
  flex-shrink: 0;
}

@media(max-width:480px){
  .message-send { flex-direction: column; }
  .message-send button { width:100%; }
}

@media(max-width:600px){
  h1{font-size:1.5rem;}
  #logo{width:90%; max-width:250px;}
  .slider img{width:80px; height:80px;}
  .bar{width:3px;}
  .dj-name{font-size:1rem;}
  .song-title{font-size:0.85rem;}
  .status-live{font-size:1rem;}
  .live-icon{width:10px;height:10px;}
  .play-btn,.pause-btn{padding:8px 15px;font-size:1rem;}
  .volume-control input{width:80px;}
  .top-buttons button{padding:6px 12px;font-size:0.85rem;}
  .marquee-inner{font-size:0.9rem;}
}
</style>
</head>

<body>
<header>
  <h1>Radio LPK-Sadulur</h1>
  <img src="image/logo.png" alt="Logo Radio" id="logo">
</header>

<div class="marquee">
  <div class="marquee-inner">Selamat Datang di Radio LPK-Sadulur ‚Ä¢ Selamat Mendengarkan ‚Ä¢ Dulur Salembur Baraya Sakota ‚Ä¢</div>
</div>

<div class="live-info">
  <div class="status-live">
    <span class="live-icon"></span> LIVE - DJ : EDO
    <span class="live-icon"></span>
  </div>
  <!--<div class="dj-name" id="djName">DJ: --</div> -->
  <div class="song-title" id="songTitle">Lagu: --</div>
</div>

<div class="player-container">
  <audio id="radio" crossorigin="anonymous">
    <source src="https://icecast.lpksadulur.online/live" type="audio/mpeg">
    Browser Anda tidak mendukung pemutar audio.
  </audio>

  <div class="controls">
    <button class="play-btn" id="playBtn">‚ñ∂Ô∏è Play</button>
    <button class="pause-btn" id="pauseBtn">‚è∏Ô∏è Pause</button>
  </div>

  <div class="volume-control">
    <span id="muteBtn">üîä</span>
    <input type="range" id="volume" min="0" max="1" step="0.01" value="1">
  </div>

  <div class="equalizer" id="equalizer"></div>
</div>

<div class="top-buttons">
  <button onclick="window.open('https://lpksadulur.online/website/')">Website</button>
  <!--<button id="requestBtn">Request</button>-->
</div>

<div class="slider">
  <div class="slider-track">
    <img src="https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=200">
    <img src="https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?w=200">
    <img src="https://images.unsplash.com/photo-1519996529931-28324d5a630e?w=200">
    <img src="https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?w=200">
    <img src="https://images.unsplash.com/photo-1507874457470-272b3c8d8ee2?w=200">
  </div>
</div>

<div class="chat-container">
  <h2>Live Chat</h2>
  <div id="chatBox" class="chat-box"></div>
  <div class="chat-input">
    <input type="text" id="chatName" placeholder="Nama Anda">
    <div class="message-send">
      <input type="text" id="chatMessage" placeholder="Ketik pesan...">
      <button id="sendChatBtn">Kirim</button>
    </div>
  </div>
</div>

<div id="clock"></div>

<footer>&copy; <span id="year"></span> Radio LPK-Sadulur</footer>

<!-- Request Modal -->
<div id="requestModal">
  <div id="requestModalContent">
    <h3 style="text-align:center; margin-bottom:15px;">Request Lagu</h3>
    <label>Nama:</label>
    <input type="text" id="reqName">
    <label>Judul Lagu:</label>
    <input type="text" id="reqSong">
    <label>Artis:</label>
    <input type="text" id="reqArtist">
    <label>Salam:</label>
    <textarea id="reqMessage"></textarea>
    <div style="display:flex; justify-content:space-between;">
      <button id="closeRequest">Tutup</button>
      <button id="submitRequest">Kirim</button>
    </div>
  </div>
</div>

<script>
// --- Player & Visualizer ---
const audio = document.getElementById('radio');
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const volumeSlider = document.getElementById('volume');
const muteBtn = document.getElementById('muteBtn');
const equalizer = document.getElementById('equalizer');
const barsCount = 40;
let bars = [], audioCtx, analyser, dataArray, source, lastVolume = 1;

// Generate bars
for(let i=0;i<barsCount;i++){
  let bar = document.createElement('div');
  bar.classList.add('bar');
  bar.style.height = '10px';
  equalizer.appendChild(bar);
  bars.push(bar);
}

// Visualizer
function initVisualizer(){
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  source = audioCtx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(audioCtx.destination);
  analyser.fftSize = 128;
  dataArray = new Uint8Array(analyser.frequencyBinCount);

  function draw(){
    requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);
    bars.forEach((bar,i)=>{
      bar.style.height = (dataArray[i % dataArray.length]/1.5)+'px';
      bar.style.background = `linear-gradient(180deg,hsl(${i*10},100%,50%),#a855f7,#f43f5e,#f59e0b)`;
    });
  }
  draw();
}

// Play/Pause
playBtn.addEventListener('click',()=>{ audio.play(); if(!audioCtx) initVisualizer(); });
pauseBtn.addEventListener('click',()=>{ audio.pause(); });

// Volume & Mute
volumeSlider.addEventListener('input', e=>{
  audio.volume = e.target.value;
  muteBtn.textContent = audio.volume>0?'üîä':'üîá';
});

muteBtn.addEventListener('click',()=>{
  if(audio.volume>0){ lastVolume = audio.volume; audio.volume = 0; volumeSlider.value = 0; muteBtn.textContent = 'üîá'; }
  else { audio.volume = lastVolume; volumeSlider.value = lastVolume; muteBtn.textContent = 'üîä'; }
});

// --- Tahun ---
document.getElementById('year').textContent = new Date().getFullYear();

// --- Request Modal ---
const requestBtn = document.getElementById('requestBtn');
const requestModal = document.getElementById('requestModal');
const closeRequest = document.getElementById('closeRequest');
const submitRequest = document.getElementById('submitRequest');

requestBtn.addEventListener('click', ()=>{ requestModal.style.display='flex'; });
closeRequest.addEventListener('click', ()=>{ requestModal.style.display='none'; });

submitRequest.addEventListener('click', ()=>{
  const name = document.getElementById('reqName').value.trim();
  const song = document.getElementById('reqSong').value.trim();
  const artist = document.getElementById('reqArtist').value.trim();
  const message = document.getElementById('reqMessage').value.trim();
  if(!name || !song || !artist){ alert('Nama, Judul Lagu, dan Artis wajib diisi!'); return; }
  fetch('request.php',{
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:`name=${encodeURIComponent(name)}&song=${encodeURIComponent(song)}&artist=${encodeURIComponent(artist)}&message=${encodeURIComponent(message)}`
  })
  .then(r=>r.text())
  .then(t=>{
    alert(t);
    requestModal.style.display='none';
    document.getElementById('reqName').value='';
    document.getElementById('reqSong').value='';
    document.getElementById('reqArtist').value='';
    document.getElementById('reqMessage').value='';
  })
  .catch(err=>alert('Terjadi kesalahan: '+err));
});

// --- Jam & Tanggal ---
const clock = document.getElementById('clock');
function updateClock(){
  const now = new Date();
  const options = { weekday:'long', year:'numeric', month:'long', day:'numeric' };
  const dateStr = now.toLocaleDateString('id-ID', options);
  const timeStr = now.toLocaleTimeString('id-ID', {hour12:false});
  clock.textContent = `${dateStr} | ${timeStr}`;
}
setInterval(updateClock, 1000);
updateClock();

// --- Update DJ & Lagu ---
function updateDJ(){
  fetch('https://icecast.lpksadulur.online/status-json.xsl')
  .then(r=>r.json())
  .then(data=>{
    const s = data.icestats.source;
    const live = Array.isArray(s) ? s.find(x=>x.listenurl.includes('/live')) : s;
    const dj = document.getElementById('djName');
    const song = document.getElementById('songTitle');
    if(live){
      let artist = live.artist || live.title || "--";
      let title = live.title || live.artist || "--";
    <!--  dj.textContent = `DJ: ${artist}`; -->
      song.textContent = `Lagu: ${title}`;
    } else {
      dj.textContent = "DJ: --";
      song.textContent = "Lagu: --";
    }
  }).catch(err=>console.error("Gagal mengambil data DJ:", err));
}
updateDJ();
setInterval(updateDJ, 10000);

// --- Live Chat ---
const chatBox = document.getElementById('chatBox');
const chatName = document.getElementById('chatName');
const chatMessage = document.getElementById('chatMessage');
const sendChatBtn = document.getElementById('sendChatBtn');

function fetchChats(){
  fetch('live_chat.php?action=fetch')
  .then(r=>r.json())
  .then(data=>{
    chatBox.innerHTML='';
    data.forEach(c=>{
      const div = document.createElement('div');
      div.classList.add('chat-msg');
      div.classList.add(c.name === chatName.value.trim() ? 'user' : 'other');
      div.textContent = `${c.name}: ${c.message}`;
      chatBox.appendChild(div);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  }).catch(err=>console.error(err));
}

sendChatBtn.addEventListener('click', ()=>{
  const name = chatName.value.trim();
  const msg = chatMessage.value.trim();
  if(!name || !msg){ alert('Nama & pesan wajib diisi'); return; }
  fetch('live_chat.php?action=send', {
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:`name=${encodeURIComponent(name)}&message=${encodeURIComponent(msg)}`
  })
  .then(r=>r.json())
  .then(()=>{ chatMessage.value=''; fetchChats(); })
  .catch(err=>console.error(err));
});

chatMessage.addEventListener('keypress', e=>{
  if(e.key === 'Enter'){ sendChatBtn.click(); e.preventDefault(); }
});

setInterval(fetchChats, 10000);
fetchChats();
</script>
</body>
</html>
